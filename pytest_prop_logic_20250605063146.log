============================= test session starts =============================
platform win32 -- Python 3.9.12, pytest-8.4.0, pluggy-1.6.0
rootdir: D:\2025-Epita-Intelligence-Symbolique-4
configfile: pytest.ini
plugins: anyio-4.9.0, asyncio-1.0.0, cov-6.1.1, mock-3.14.1
asyncio: mode=auto, asyncio_default_fixture_loop_scope=function, asyncio_default_test_loop_scope=function
collected 13 items

tests\agents\core\logic\test_propositional_logic_agent.py .F...........  [100%]2025-06-05 06:31:49,215 - tests.mocks.jpype_setup - INFO - jpype_setup.py: pytest_sessionfinish hook triggered. Exit status: 1
2025-06-05 06:31:49,215 - tests.mocks.jpype_setup - INFO -    pytest_sessionfinish: sys.modules['jpype'] IS _REAL_JPYPE_MODULE. Le vrai JPype a potentiellement été utilisé.
2025-06-05 06:31:49,215 - tests.mocks.jpype_setup - INFO -    pytest_sessionfinish: Tentative d'arrêt de la JVM via shutdown_jvm_if_needed() car le vrai JPype a potentiellement été utilisé.
2025-06-05 06:31:49,215 - tests.mocks.jpype_setup - INFO -    pytest_sessionfinish: Vérification de l'état de la JVM après tentative d'arrêt.
2025-06-05 06:31:49,215 - tests.mocks.jpype_setup - INFO -    pytest_sessionfinish: JVM encore démarrée après tentative d'arrêt: False
2025-06-05 06:31:49,215 - tests.mocks.jpype_setup - INFO -    pytest_sessionfinish: destroy_jvm est False (selon config): False
2025-06-05 06:31:49,215 - tests.mocks.jpype_setup - INFO -    pytest_sessionfinish: JVM non démarrée ou destroy_jvm est True. Pas de gestion spéciale de sys.modules pour atexit depuis ici.
python : 06:31:49 [INFO] [Orchestration.JPype] JVM_SETUP: Appel de shutdown_jvm_if_needed.
Au caractère Ligne:1 : 214
+ ... tputFile)"; python -m pytest tests/agents/core/logic/test_proposition ...
+                 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : NotSpecified: (06:31:49 [INFO]..._jvm_if_needed.:String) [], RemoteException
    + FullyQualifiedErrorId : NativeCommandError
 
06:31:49 [INFO] [Orchestration.JPype] JVM_SETUP: JVM n'était pas démarrée. Aucun arrêt nécessaire. isJVMStarted: False
06:31:49 [DEBUG] [tests.mocks.jpype_components.jvm] isJVMStarted() appelée. Retourne: False


================================== FAILURES ===================================
_________ TestPropositionalLogicAgent.test_execute_query_error_tweety _________

self = <test_propositional_logic_agent.TestPropositionalLogicAgent testMethod=test_execute_query_error_tweety>

    def test_execute_query_error_tweety(self):
        """Test de l'ex�cution d'une requ�te avec erreur de Tweety."""
        belief_set_obj = PropositionalBeliefSet("a => b")
        if not os.environ.get('USE_REAL_JPYPE', 'false').lower() in ('true', '1'):
            # Assurer que le mock retourne la cha�ne attendue par l'agent pour ce test
            self.mock_tweety_bridge_instance.execute_pl_query.return_value = (False, "FUNC_ERROR: Erreur de syntaxe Tweety")
            self.mock_tweety_bridge_instance.validate_formula.return_value = (True, "Formule valide")
    
        result, message = self.agent.execute_query(belief_set_obj, "a")
    
        self.mock_tweety_bridge_instance.validate_formula.assert_called_once_with(formula_string="a")
        self.mock_tweety_bridge_instance.execute_pl_query.assert_called_once_with(
            belief_set_content="a => b",
            query_string="a"
        )
    
        # Avec la vraie JVM, 'a' est rejet� par 'a => b'.
        self.assertFalse(result) # 'a' n'est pas une cons�quence de 'a => b', donc result est False.
>       self.assertEqual(message, "Tweety Result: Query 'a' is REJECTED (False).")
E       AssertionError: 'FUNC_ERROR: Erreur de syntaxe Tweety' != "Tweety Result: Query 'a' is REJECTED (False)."
E       - FUNC_ERROR: Erreur de syntaxe Tweety
E       + Tweety Result: Query 'a' is REJECTED (False).

tests\agents\core\logic\test_propositional_logic_agent.py:235: AssertionError
---------------------------- Captured stdout setup ----------------------------
2025-06-05 06:31:48,921 - tests.mocks.jpype_setup - INFO - Test test_execute_query_error_tweety utilise MOCK JPype.
2025-06-05 06:31:48,921 - tests.mocks.jpype_setup - INFO - �tat (_jvm_started, _jvm_path, config.jvm_path) du mock JPype r�initialis� pour le test.
---------------------------- Captured stderr call -----------------------------
06:31:48 [INFO] [agent.PropositionalLogicAgent.TestPLAgent] Configuration des composants pour TestPLAgent...
06:31:48 [INFO] [agent.PropositionalLogicAgent.TestPLAgent] TweetyBridge initialis� pour TestPLAgent. JVM pr�te: True
06:31:48 [INFO] [agent.PropositionalLogicAgent.TestPLAgent] Fonction s�mantique TestPLAgent.TextToPLBeliefSet ajout�e.
06:31:48 [INFO] [agent.PropositionalLogicAgent.TestPLAgent] Fonction s�mantique TestPLAgent.GeneratePLQueries ajout�e.
06:31:48 [INFO] [agent.PropositionalLogicAgent.TestPLAgent] Fonction s�mantique TestPLAgent.InterpretPLResults ajout�e.
06:31:48 [INFO] [agent.PropositionalLogicAgent.TestPLAgent] Composants pour TestPLAgent configur�s.
06:31:48 [INFO] [agent.PropositionalLogicAgent.TestPLAgent] Ex�cution de la requ�te PL: 'a' sur le BeliefSet.
06:31:48 [ERROR] [agent.PropositionalLogicAgent.TestPLAgent] Erreur fonctionnelle de TweetyBridge pour la requ�te 'a': FUNC_ERROR: Erreur de syntaxe Tweety
06:31:48 [INFO] [agent.PropositionalLogicAgent.TestPLAgent] R�sultat de l'ex�cution pour 'a': None, Output brut: 'FUNC_ERROR: Erreur de syntaxe Tweety'
------------------------------ Captured log call ------------------------------
INFO     agent.PropositionalLogicAgent.TestPLAgent:propositional_logic_agent.py:90 Configuration des composants pour TestPLAgent...
INFO     agent.PropositionalLogicAgent.TestPLAgent:propositional_logic_agent.py:96 TweetyBridge initialis� pour TestPLAgent. JVM pr�te: True
INFO     agent.PropositionalLogicAgent.TestPLAgent:propositional_logic_agent.py:135 Fonction s�mantique TestPLAgent.TextToPLBeliefSet ajout�e.
INFO     agent.PropositionalLogicAgent.TestPLAgent:propositional_logic_agent.py:135 Fonction s�mantique TestPLAgent.GeneratePLQueries ajout�e.
INFO     agent.PropositionalLogicAgent.TestPLAgent:propositional_logic_agent.py:135 Fonction s�mantique TestPLAgent.InterpretPLResults ajout�e.
INFO     agent.PropositionalLogicAgent.TestPLAgent:propositional_logic_agent.py:139 Composants pour TestPLAgent configur�s.
INFO     agent.PropositionalLogicAgent.TestPLAgent:propositional_logic_agent.py:248 Ex�cution de la requ�te PL: 'a' sur le BeliefSet.
ERROR    agent.PropositionalLogicAgent.TestPLAgent:propositional_logic_agent.py:265 Erreur fonctionnelle de TweetyBridge pour la requ�te 'a': FUNC_ERROR: Erreur de syntaxe Tweety
INFO     agent.PropositionalLogicAgent.TestPLAgent:propositional_logic_agent.py:276 R�sultat de l'ex�cution pour 'a': None, Output brut: 'FUNC_ERROR: Erreur de syntaxe Tweety'
-------------------------- Captured stdout teardown ---------------------------
2025-06-05 06:31:49,112 - tests.mocks.jpype_setup - INFO - �tat de JPype restaur� apr�s test test_execute_query_error_tweety (utilisation du mock).
============================== warnings summary ===============================
C:\Users\MYIA\AppData\Roaming\Python\Python39\site-packages\pydantic\_internal\_config.py:291
  C:\Users\MYIA\AppData\Roaming\Python\Python39\site-packages\pydantic\_internal\_config.py:291: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.9/migration/
    warnings.warn(DEPRECATION_MESSAGE, DeprecationWarning)

C:\Users\MYIA\AppData\Roaming\Python\Python39\site-packages\pydantic\_internal\_config.py:341
  C:\Users\MYIA\AppData\Roaming\Python\Python39\site-packages\pydantic\_internal\_config.py:341: UserWarning: Valid config keys have changed in V2:
  * 'allow_population_by_field_name' has been renamed to 'populate_by_name'
    warnings.warn(message, UserWarning)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ===========================
FAILED tests/agents/core/logic/test_propositional_logic_agent.py::TestPropositionalLogicAgent::test_execute_query_error_tweety
================== 1 failed, 12 passed, 2 warnings in 2.26s ===================
